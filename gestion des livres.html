<!doctype html>
<html lang="fr">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Gestion des Livres</title>
        <link rel="stylesheet" href="styles.css" />
    </head>
    <body class="bg-light">
        <header class="topbar">
            <div>
                <div class="hello">Bonjour <strong>Admin</strong></div>
                <div class="sub">Gestion des livres</div>
            </div>
            <a class="btn btn-outline" href="login.html">Déconnexion</a>
        </header>

        <main class="container">
            <section class="card">
                <h2>Ajouter un nouveau livre</h2>
                <form action="#" method="post" class="grid">
                    <input type="text" name="livre-id" id="livre-id" style="display: none;" required />
                    <label class="field">
                        <span>Titre</span>
                        <input type="text" name="titre" id="titre" required />
                    </label>

                    <label class="field">
                        <span>Auteur</span>
                        <input type="text" name="auteur" id="auteur" required />
                    </label>

                    <label class="field">
                        <span>Année</span>
                        <input type="number" name="annee" id="annee" required />
                    </label>

                    <label class="field">
                        <span>Disponible</span>
                        <select name="disponible" id="disponible">
                            <option value="1">Oui</option>
                            <option value="0">Non</option>
                        </select>
                    </label>

                    <div class="actions">
                        <button
                            id="ajoute-button"
                            class="btn btn-success"
                            type="button"
                            onclick="ajouterLivre()"
                        >
                            Ajouter le livre
                        </button>
                        <button
                            id="modifier-button"
                            class="btn btn-warning"
                            type="button"
                            style="display: none;"
                            onclick="modifier()"
                        >
                            Modifier le livre
                        </button>
                    </div>
                </form>
            </section>

            <section class="card">
                <div class="card-head">
                    <h2>Liste des livres</h2>
                    <input
                        class="search"
                        type="search"
                        id="search-input"
                        placeholder="Rechercher (maquette)..."
                    />
                </div>

                <div class="table-wrap">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Titre</th>
                                <th>Auteur</th>
                                <th>Année</th>
                                <th>Disponible</th>
                                <th>Modifier</th>
                                <th>Supprimer</th>
                            </tr>
                        </thead>
                        <tbody id="table-body"></tbody>
                    </table>
                </div>
                <p class="hint">
                    Tout est statique ici (pas de DB, pas de JS).
                </p>
            </section>
        </main>

        <script>
            var livres = [
                {
                    id: 1,
                    titre: "Le Petit Prince",
                    auteur: "Antoine de Saint-Exupéry",
                    annee: "1943",
                    disponible: "Oui",
                },
                {
                    id: 2,
                    titre: "L'Étranger",
                    auteur: "Albert Camus",
                    annee: "1942",
                    disponible: "Non",
                },
            ];
            function displayLivres(listLivres = livres) {
                document.getElementById("table-body").innerHTML = "";
                for (let livre of listLivres) {
                    document.getElementById("table-body").innerHTML += `
                        <tr>
                            <td>${livre.id}</td>
                            <td>${livre.titre}</td>
                            <td>${livre.auteur}</td>
                            <td>${livre.annee}</td>
                            <td>${livre.disponible}</td>
                            <td><button onclick="modifierLivre()" id="${livre.id}" class="btn btn-warning">Modifier</button></td>
                            <td><button onclick="supprimerLivre()" id="${livre.id}" class="btn btn-danger">Supprimer</button></td>
                        </tr>
                    `;
                }
            }

            displayLivres();

            function ajouterLivre() {
                let nvTitre = document.getElementById("titre").value;
                let nvAuteur = document.getElementById("auteur").value;
                let nvAnnee = document.getElementById("annee").value;
                let nvDisponible = document.getElementById("disponible").value == 1 ? "Oui" : "Non";
                livres.push({
                    id: Math.trunc(Math.random() * 500),
                    titre: nvTitre,
                    auteur: nvAuteur,
                    annee: nvAnnee,
                    disponible: nvDisponible,
                });
                displayLivres();
            }

            function supprimerLivre(id) {
                let livreSupprimerId = id ?? event.target.id;
                for (let i = 0; i < livres.length; i++) {
                    if (livres[i].id == livreSupprimerId) {
                        livres.splice(i, 1);
                        displayLivres();
                        return true;
                    }
                }
                return false;
            }

            function modifierLivre() {
                let livreModifierId = event.target.id;

                document.getElementById('ajoute-button').style.display = 'none';
                document.getElementById('modifier-button').style.display = 'inline';

                for (let livre of livres) {
                    if (livre.id == livreModifierId) {
                        document.getElementById("livre-id").value = livre.id;
                        document.getElementById("titre").value = livre.titre;
                        document.getElementById("auteur").value = livre.auteur;
                        document.getElementById("annee").value = livre.annee;
                        document.getElementById("disponible").value = livre.disponible == "Oui" ? 1 : 0;
                    }
                }
            }

            function modifier() {
                let modfId = document.getElementById("livre-id").value;
                let modfTitre = document.getElementById("titre").value;
                let modfAuteur = document.getElementById("auteur").value;
                let modfAnnee = document.getElementById("annee").value;
                let modfDisponible = document.getElementById("disponible").value == 1 ? "Oui" : "Non";

                supprimerLivre(modfId);

                livres.push({
                    id: modfId,
                    titre: modfTitre,
                    auteur: modfAuteur,
                    annee: modfAnnee,
                    disponible: modfDisponible,
                });

                displayLivres();

                document.getElementById('ajoute-button').style.display = 'inline';
                document.getElementById('modifier-button').style.display = 'none';

                document.getElementById("titre").value = "";
                document.getElementById("auteur").value = "";
                document.getElementById("annee").value = "";
                document.getElementById("disponible").value = 1;
            }

            var filterdLivres = [];
            const search = document.getElementById('search-input');
            search.addEventListener("input", function() {
                let titreToSearch = event.target.value.toLowerCase();
                filterdLivres = [];
                if (titreToSearch.length != 0) {
                    for (let livre of livres) {
                        if (livre.titre.toLowerCase().startsWith(titreToSearch) === true) {
                            filterdLivres.push(livre);
                        }
                        displayLivres(filterdLivres);
                    }
                } else {
                    displayLivres(livres);
                }
            });
        </script>
    </body>
</html>
